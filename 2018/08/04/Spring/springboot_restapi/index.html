<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.9.0">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="개발관련">
    

    <!--Author-->
    
        <meta name="author" content="beanbroker">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Spring boot Rest Api">
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="개발관련">
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="beanbroker blog">

    <!--Type page-->
    
        <meta property="og:type" content="article">
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary">
    

    <!-- Title -->
    
    <title>Spring boot Rest Api - beanbroker blog</title>

    <!-- Tachyons Core CSS -->
    <link rel="stylesheet" href="https://unpkg.com/tachyons/css/tachyons.min.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-86502943-1', 'auto');
        ga('send', 'pageview');

    </script>



</head>

<link rel="canonical" href="http://yoursite.com/2018/08/04/spring/springboot_restapi/">

<body>

<!-- Main Content -->
<!-- Banner -->
<!-- Banner -->
<div class="w-100 bg-1 ph5-ns ph3 text-light">
    
    <nav class="db dt-l w-100 mw8 center border-box pv3">
        <a class="db dtc-l v-mid link dim w-100 w-25-l tc tl-l mb2 mb0-l white" href="/" title="beanbroker blog">
            <img src="http://www.codeblocq.com/assets/projects/hexo-theme-anodyne/assets/anodyne.svg" class="dib h3" alt="beanbroker blog">
        </a>
        <div class="db dtc-l v-mid w-100 w-75-l tc tr-l">
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" href="/" title="Home">
                    Home
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" href="/tags" title="Tags">
                    Tags
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" href="/about.html" title="About">
                    About
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" href="/contact.html" title="Contact">
                    Contact
                </a>
            
        </div>
    </nav>

    <!-- Title -->
    <div class="w-100 mw8 center vh-40 dt">
        <div class="dtc v-mid white">
            <h1 class="f1-l f2-m tc tc-m tl-ns">Spring boot Rest Api</h1>
            <p class="f4 fw3 pab-100px tc tc-m tl-ns">2018-08-04</p>
        </div>
    </div>

    <!-- Icon -->
    <div class="relative w-100 mw8 center white dn dn-m db-ns">
        <i class="header-icon fa fa-file-text-o"></i>
    </div>
</div>

<!-- Content -->
<div class="w-100 ph2 ph4-m ph5-l mv5 mv6-l">
    <div class="content">
        <div class="mw8 center">
            <div class="cf">
                <div class="fl w-100 w-70-l mw7 left fw3 lh-copy pr4-ns pr0-m post-content">
                    <!-- Tags Vertical -->
                    
                        <div class="tags-container-vertical">
                            <div class="tags-sub-container">
                                <a class="fw3 ph1 dib" href="/tags/Spring/">#Spring</a> <a class="fw3 ph1 dib" href="/tags/Rest/">#Rest</a>
                            </div>
                        </div>
                    

                    <!-- Main Post Content -->
                    <h1 id="REST-API"><a href="#REST-API" class="headerlink" title="REST API"></a>REST API</h1><p>Rest는 get,put,post,delete 등과 같은 동사와 http 헤더, 상태 코드 등 비지니스 상태 변경을 외부에 노출하는 것과 관련된 모든 것을 말한다. 좋은 Rest Api는 Http의 기능을 최대한 활용한다. Rest는 어떤 기술 표준이 아니다, 자원단위의 표시라고 생각되며 Http에 대한 일종의 아키텍처 제약사항이다. 물론 모든 것에 제약사항을 걸며 개발하기 힘들겠지만 최대한 노력해야 한다.</p>
<blockquote>
<p>스프링 부트에서 boot-start-web을 추가하면 서블릿 컨테이너와 스프링 mvc의 모들 설정을 가져 온다.(편하다.. 하하)</p>
</blockquote>
<h2 id="간단한-RestController-예제를-만들기"><a href="#간단한-RestController-예제를-만들기" class="headerlink" title="간단한 RestController 예제를 만들기"></a>간단한 RestController 예제를 만들기</h2><p>@RestController만 붙이면 해당 컨트롤러는 즉각적으로 사용이 가능한다.</p>
<blockquote>
<p>SampleController</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">class SampleController &#123;</span><br><span class="line">    @RequestMapping(&quot;/&quot;)</span><br><span class="line">    String getHello()&#123;</span><br><span class="line">        return &quot;Hello World !!&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>너무나도 쉽게 위의 코드면 헬로월드를 얻을 수 있다.</p>
<blockquote>
<p>실제 db에 접근하여 CRUD를 구현해보자</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/v1/customers&quot;)</span><br><span class="line">public class CustomerRestController &#123;</span><br><span class="line"></span><br><span class="line"> @Autowired</span><br><span class="line"> private CustomerRepository customerRepository;</span><br><span class="line"></span><br><span class="line"> // &lt;1&gt;</span><br><span class="line"> @RequestMapping(method = RequestMethod.OPTIONS)</span><br><span class="line"> ResponseEntity&lt;?&gt; options() &#123;</span><br><span class="line"></span><br><span class="line">  //@formatter:off</span><br><span class="line">  return ResponseEntity</span><br><span class="line">   .ok()</span><br><span class="line">   .allow(HttpMethod.GET, HttpMethod.POST,</span><br><span class="line">          HttpMethod.HEAD, HttpMethod.OPTIONS,</span><br><span class="line">          HttpMethod.PUT, HttpMethod.DELETE)</span><br><span class="line">          .build();</span><br><span class="line">   //@formatter:on</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> @GetMapping</span><br><span class="line"> ResponseEntity&lt;Collection&lt;Customer&gt;&gt; getCollection() &#123;</span><br><span class="line">  return ResponseEntity.ok(this.customerRepository.findAll());</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> // &lt;2&gt;</span><br><span class="line"> @GetMapping(value = &quot;/&#123;id&#125;&quot;)</span><br><span class="line"> ResponseEntity&lt;Customer&gt; get(@PathVariable Long id) &#123;</span><br><span class="line">  return this.customerRepository.findById(id).map(ResponseEntity::ok)</span><br><span class="line">   .orElseThrow(() -&gt; new CustomerNotFoundException(id));</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> @PostMapping</span><br><span class="line"> ResponseEntity&lt;Customer&gt; post(@RequestBody Customer c) &#123; // &lt;3&gt;</span><br><span class="line"></span><br><span class="line">  Customer customer = this.customerRepository.save(new Customer(c</span><br><span class="line">   .getFirstName(), c.getLastName()));</span><br><span class="line"></span><br><span class="line">  URI uri = MvcUriComponentsBuilder.fromController(getClass()).path(&quot;/&#123;id&#125;&quot;)</span><br><span class="line">   .buildAndExpand(customer.getId()).toUri();</span><br><span class="line">  return ResponseEntity.created(uri).body(customer);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> // &lt;4&gt;</span><br><span class="line"> @DeleteMapping(value = &quot;/&#123;id&#125;&quot;)</span><br><span class="line"> ResponseEntity&lt;?&gt; delete(@PathVariable Long id) &#123;</span><br><span class="line">  return this.customerRepository.findById(id).map(c -&gt; &#123;</span><br><span class="line">   customerRepository.delete(c);</span><br><span class="line">   return ResponseEntity.noContent().build();</span><br><span class="line">  &#125;).orElseThrow(() -&gt; new CustomerNotFoundException(id));</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> // &lt;5&gt;</span><br><span class="line"> @RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.HEAD)</span><br><span class="line"> ResponseEntity&lt;?&gt; head(@PathVariable Long id) &#123;</span><br><span class="line">  return this.customerRepository.findById(id)</span><br><span class="line">   .map(exists -&gt; ResponseEntity.noContent().build())</span><br><span class="line">   .orElseThrow(() -&gt; new CustomerNotFoundException(id));</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> // &lt;6&gt;</span><br><span class="line"> @PutMapping(value = &quot;/&#123;id&#125;&quot;)</span><br><span class="line"> ResponseEntity&lt;Customer&gt; put(@PathVariable Long id, @RequestBody Customer c) &#123;</span><br><span class="line">  return this.customerRepository</span><br><span class="line">   .findById(id)</span><br><span class="line">   .map(</span><br><span class="line">    existing -&gt; &#123;</span><br><span class="line">     Customer customer = this.customerRepository.save(new Customer(existing</span><br><span class="line">      .getId(), c.getFirstName(), c.getLastName()));</span><br><span class="line">     URI selfLink = URI.create(ServletUriComponentsBuilder.fromCurrentRequest()</span><br><span class="line">      .toUriString());</span><br><span class="line">     return ResponseEntity.created(selfLink).body(customer);</span><br><span class="line">    &#125;).orElseThrow(() -&gt; new CustomerNotFoundException(id));</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>요청을 처리하는 핸들러 메소드 -&gt; @RequestMapping</li>
<li>GetMapping - method get, 데이터 읽기</li>
<li>PostMapping - method post, 데이터 넣기</li>
<li>DeleteMapping - method delete, 데이터 삭제(현업에서는 절대 해당 필드삭제를 자제하자, DB에 소프트 델리트가 가능하도록 필드를 설정하는 것을 지향해야한다.)</li>
<li>PutMapping - method put - 데이터 갱신</li>
</ul>
<blockquote>
<p>위의코드는 누구든 쉽게 crud를 바로 적용할수 있다.</p>
</blockquote>
<h2 id="RestController-ControllerAdvice"><a href="#RestController-ControllerAdvice" class="headerlink" title="RestController ControllerAdvice"></a>RestController ControllerAdvice</h2><p>프로젝트를 진행하며 aop가 활용되어 있는 부분을 볼수 있다. 그중 ControllerAdvice는 스프링 환경에서 default로 쓰인다고 생각할수 있다. 해당 어노테이션이 붙으면 컨트롤러로 request가 들어오기 전에 검증을 할수 있다. 물론 function단위로 exception handler를 달아 하나하나 구현도 가능하지만 공통된 error handling이 가능하다.</p>
<ul>
<li>@ExceoptionHandler 대신  @ControllerAdvice를 사용하자(공통 예외처리)</li>
</ul>
<blockquote>
<p>ControllerAdvice</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@ControllerAdvice(annotations = RestController.class)</span><br><span class="line">public class CustomerControllerAdvice &#123;</span><br><span class="line"></span><br><span class="line"> // &lt;1&gt;</span><br><span class="line"> private final MediaType vndErrorMediaType = MediaType</span><br><span class="line">  .parseMediaType(&quot;application/vnd.error&quot;);</span><br><span class="line"></span><br><span class="line"> // &lt;2&gt;</span><br><span class="line"> @ExceptionHandler(CustomerNotFoundException.class)</span><br><span class="line"> ResponseEntity&lt;VndErrors&gt; notFoundException(CustomerNotFoundException e) &#123;</span><br><span class="line">  return this.error(e, HttpStatus.NOT_FOUND, e.getCustomerId() + &quot;&quot;);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> @ExceptionHandler(IllegalArgumentException.class)</span><br><span class="line"> ResponseEntity&lt;VndErrors&gt; assertionException(IllegalArgumentException ex) &#123;</span><br><span class="line">  return this.error(ex, HttpStatus.NOT_FOUND, ex.getLocalizedMessage());</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> // &lt;3&gt;</span><br><span class="line"> private &lt;E extends Exception&gt; ResponseEntity&lt;VndErrors&gt; error(E error,</span><br><span class="line">  HttpStatus httpStatus, String logref) &#123;</span><br><span class="line">  String msg = Optional.of(error.getMessage()).orElse(</span><br><span class="line">   error.getClass().getSimpleName());</span><br><span class="line">  HttpHeaders httpHeaders = new HttpHeaders();</span><br><span class="line">  httpHeaders.setContentType(this.vndErrorMediaType);</span><br><span class="line">  return new ResponseEntity&lt;&gt;(new VndErrors(logref, msg), httpHeaders,</span><br><span class="line">   httpStatus);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> &lt;클라우드 네이티브 자바 6장 restapi 참고&gt;</p>

                    
                    <!-- Tags Bottom -->
                    
                        <div class="tags-container-bottom">
                            <i class="fa fa-tag pr3 text-main-color"></i><a class="fw3 ph1 dib" href="/tags/Spring/">#Spring</a> <a class="fw3 ph1 dib" href="/tags/Rest/">#Rest</a>
                        </div>
                    

                    <!-- Comments -->
                    



                </div>
                <div class="fl w-100 w-30-l center fw3 lh-copy pl4-ns tl black-50">
                    
                    <hr class="dn-l mw4 black-50 mt5">
                    
                    <!-- Widget 1: About -->
                    <div class="mt5 mt0-l">
    <article class="dt db-l mw8 mw8-m mw5-ns center ml0-l bg-white mv3">
        <div class="dn dtc-m db-l v-mid tc pr4 pr0-l" style="min-width: 6rem;">
            <img src="http://tachyons.io/img/avatar_1.jpg" class="mb4-l br-100 h3 w3 h4-l w4-l dib" title="beanbroker">
        </div>
        <div class="dtc db-l v-mid lh-copy measure center f6 black-50 tj">
            Good to see you! have a fun
        </div>
    </article>
</div>

                    <hr class="dn-l mw4 black-50 mt5">
                    
                    <!-- Widget 2: Categories -->
                    
                        <div class="mt5 tc tl-l">
    <h3>Categories</h3>
    
        <p>
            <a href="/categories/Spring/">Spring</a>
        </p>
    
        <p>
            <a href="/categories/Spring/Rest/">Rest</a>
        </p>
    
</div>


                        <hr class="dn-l mw4 black-50 mt5">
                    

                    <!-- Widget 3: Recent Posts -->
                    <div class="mt5 tc tl-l">
    <h3>Recent Posts</h3>
    
        <p>
            <a href="/2019/07/21/spring_cloud/spring_cloud_gateway1/">Spring cloud 1장 (gateway)</a>
        </p>
    
        <p>
            <a href="/2019/07/21/Java/Object_java1/">OBJECT 1장</a>
        </p>
    
        <p>
            <a href="/2019/07/14/Java/java_querydsl_gradle4-2/">Spring boot With Querydsl Java (gradle 4 버젼용) 2장</a>
        </p>
    
        <p>
            <a href="/2019/07/13/Java/java_querydsl_gradle4-1/">Spring boot With Querydsl Java (gradle 4 버젼용) 1장</a>
        </p>
    
        <p>
            <a href="/2019/07/13/Java/java_querydsl_gradle5/">Spring boot With Querydsl Java (gradle 5.0 이상)</a>
        </p>
    
</div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Footer -->
<div class="bg-1 ph2 ph5-ns pv5">
        <div class="mv8">
            <div class="center tc">
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://www.facebook.com/" target="_blank" rel="external nofollow noopener noreferrer">
                            <i class="fa fa-facebook"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://github.com/klugjo/hexo-theme-anodyne" target="_blank" rel="external nofollow noopener noreferrer">
                            <i class="fa fa-github"></i>
                        </a>
                    </div>
                
            </div>
            <div class="f6 f5-ns center tc white pt5 fw3">
                @Beanbroker blog All right reserved | Design & Hexo <a class="link dim white" href="http://www.codeblocq.com/" rel="external nofollow noopener noreferrer" target="_blank">Jonathan Klughertz</a>
            </div>
        </div>
    </div>

<!-- After Footer -->
<!-- Disqus Comments -->



</body>

</html>
