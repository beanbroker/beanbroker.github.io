<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.9.0">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
 <meta name="naver-site-verification" content="67083ed945b6af7f93ba51ef87f7f48745abe975">
<script data-ad-client="ca-pub-7332507555012085" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<link rel="canonical" href="https://beanbroker.github.io/2018/11/10/spring/messageq/">    

    <!--Description-->
    
        <meta name="description" content="개발관련">
    

    <!--Author-->
    
        <meta name="author" content="beanbroker">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="Spring Boot with MQ">
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="개발관련">
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="beanbroker blog">

    <!--Type page-->
    
        <meta property="og:type" content="article">
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary">
    

    <!-- Title -->
    
    <title>Spring Boot with MQ - beanbroker blog</title>

    <!-- Tachyons Core CSS -->
    <link rel="stylesheet" href="https://unpkg.com/tachyons/css/tachyons.min.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-86502943-1', 'auto');
        ga('send', 'pageview');

    </script>



</head>

<link rel="canonical" href="https://beanbroker.github.io/2018/11/10/spring/messageq/">

<body>

<!-- Main Content -->
<!-- Banner -->
<!-- Banner -->
<div class="w-100 bg-1 ph5-ns ph3 text-light">
    
    <nav class="db dt-l w-100 mw8 center border-box pv3">
        <a class="db dtc-l v-mid link dim w-100 w-25-l tc tl-l mb2 mb0-l white" href="/" title="beanbroker blog">
            <img src="http://www.codeblocq.com/assets/projects/hexo-theme-anodyne/assets/anodyne.svg" class="dib h3" alt="beanbroker blog">
        </a>
        <div class="db dtc-l v-mid w-100 w-75-l tc tr-l">
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" href="/" title="Home">
                    Home
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" href="/tags" title="Tags">
                    Tags
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" href="/about.html" title="About">
                    About
                </a>
            
                <a class="link dim f6 f5-l dib mr3 mr4-l white" href="/contact.html" title="Contact">
                    Contact
                </a>
            
        </div>
    </nav>

    <!-- Title -->
    <div class="w-100 mw8 center vh-40 dt">
        <div class="dtc v-mid white">
            <h1 class="f1-l f2-m tc tc-m tl-ns">Spring Boot with MQ</h1>
            <p class="f4 fw3 pab-100px tc tc-m tl-ns">2018-11-10</p>
        </div>
    </div>

    <!-- Icon -->
    <div class="relative w-100 mw8 center white dn dn-m db-ns">
        <i class="header-icon fa fa-file-text-o"></i>
    </div>
</div>

<!-- Content -->
<div class="w-100 ph2 ph4-m ph5-l mv5 mv6-l">
    <div class="content">
        <div class="mw8 center">
            <div class="cf">
                <div class="fl w-100 w-70-l mw7 left fw3 lh-copy pr4-ns pr0-m post-content">
                    <!-- Tags Vertical -->
                    
                        <div class="tags-container-vertical">
                            <div class="tags-sub-container">
                                <a class="fw3 ph1 dib" href="/tags/Spring/">#Spring</a> <a class="fw3 ph1 dib" href="/tags/JMS/">#JMS</a> <a class="fw3 ph1 dib" href="/tags/MQ/">#MQ</a>
                            </div>
                        </div>
                    

                    <!-- Main Post Content -->
                    <h1 id="메시지-큐"><a href="#메시지-큐" class="headerlink" title="메시지 큐"></a>메시지 큐</h1><p>MOM(Message Oriented MiddleWare) 은 비동기 메시지를 사용하는 다른 응용 프로그램 사이에서 데이터 송수신을 의미.<br>MOM을 구현한 시스템을 메시지 큐(MQ)라 한다.</p>
<p>메시지 큐의 장점</p>
<ol>
<li>비동기 - Queue에 밀어 넣고 추후 처리가 가능하다</li>
<li>어플리케이션과 분리하여 사용이 가능하다.</li>
<li><p>다른 어플리케이션 또는 프로세스에서 큐에 메시지를 보내 통신을 할수 있다.</p>
<h2 id="JMS란"><a href="#JMS란" class="headerlink" title="JMS란?"></a>JMS란?</h2><p>MOM을 자바에서 지원하는 표준 API입니다.</p>
</li>
</ol>
<h2 id="오픈-소스-메시지-큐"><a href="#오픈-소스-메시지-큐" class="headerlink" title="오픈 소스 메시지 큐"></a>오픈 소스 메시지 큐</h2><p>RabbitMQ, ActiveMQ, ZeroMQ, Kafka</p>
<p>현재 aws에서 ActiveMQ, Kafka는 풀리하게 지원한다.<br>RabiitMQ를 aws환경에서 쓰기위해선 별도의 엘리스틱 빈스토크에 올려서 써야한다…. 왜…아직 지원을 안하는거지…</p>
<p>위의 큐 간단한 비교 인기순<br><a href="https://stackshare.io/stackups/activemq-vs-kafka-vs-rabbitmq" rel="external nofollow noopener noreferrer" target="_blank">https://stackshare.io/stackups/activemq-vs-kafka-vs-rabbitmq</a></p>
<h2 id="예제를-만들어보자"><a href="#예제를-만들어보자" class="headerlink" title="예제를 만들어보자"></a>예제를 만들어보자</h2><p><a href="https://github.com/beanbroker/beanbroker_spring.git" rel="external nofollow noopener noreferrer" target="_blank">https://github.com/beanbroker/beanbroker_spring.git</a> 을 클론하면 소스가 있다.</p>
<h3 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--message q--&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;spring-boot-starter-activemq&lt;/artifactId&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;spring-jms&lt;/artifactId&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.apache.activemq&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;activemq-broker&lt;/artifactId&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt;</span><br><span class="line">      &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>위의 디펜던시 추가</p>
<h2 id="CONSUMER-PRODUCER-LISTENER"><a href="#CONSUMER-PRODUCER-LISTENER" class="headerlink" title="CONSUMER, PRODUCER, LISTENER"></a>CONSUMER, PRODUCER, LISTENER</h2><p>Consumer<br>말그대로 메시지 수신하여 저장</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class JmsConsumer &#123;</span><br><span class="line">	private static Logger log = LoggerFactory.getLogger(JmsConsumer.class);</span><br><span class="line">	@Autowired</span><br><span class="line">	private MessageStorage customerStorage;</span><br><span class="line">	</span><br><span class="line">	@JmsListener(destination = &quot;$&#123;beanbroker.activemq.queue&#125;&quot;, containerFactory=&quot;jsaFactory&quot;)</span><br><span class="line">	public void receive(Customer customer)&#123;</span><br><span class="line">		log.debug(&quot;Recieved Message: &quot; + customer);</span><br><span class="line">		customerStorage.add(customer);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Producer<br>말그대로 메시지를 보냄</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public class JmsProducer &#123;</span><br><span class="line">	private static Logger log = LoggerFactory.getLogger(JmsProducer.class);</span><br><span class="line">	@Autowired</span><br><span class="line">	JmsTemplate jmsTemplate;</span><br><span class="line"></span><br><span class="line">	@Value(&quot;$&#123;beanbroker.activemq.queue&#125;&quot;)</span><br><span class="line">	String queue;</span><br><span class="line"></span><br><span class="line">	public void send(Customer customer)&#123;</span><br><span class="line"></span><br><span class="line">		log.debug(&quot;send data : &#123;&#125; &quot; , customer.toString());</span><br><span class="line">		jmsTemplate.convertAndSend(queue, customer);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Listener</p>
<p>해당 채널 큐에 메시지가 들어옴을 기다리며 들어왔을 경우 작동<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class JmsListener &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private static Logger log = LoggerFactory.getLogger(JmsListener.class);</span><br><span class="line">    @org.springframework.jms.annotation.JmsListener(destination = &quot;beanbroker-queue&quot;, containerFactory = &quot;jsaFactory&quot;)</span><br><span class="line">    public void receiveMessage(Customer customer)&#123;</span><br><span class="line"></span><br><span class="line">        log.info(&quot;test &#123;&#125;&quot; , customer.toString());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### MqController</span><br></pre></td></tr></table></figure></p>
<p>@RestController<br>public class MqController {</p>
<pre><code>@Autowired
JmsProducer jmsProducer;

@Autowired
private MessageStorage messageStorage;


@PostMapping(value=&quot;/mq/customer&quot;)
@ResponseStatus(HttpStatus.CREATED)
public Customer postCustomer(@RequestBody Customer customer){
    jmsProducer.send(customer);

    return customer;
}

@GetMapping(value=&quot;/mq/customers&quot;)
public List&lt;Customer&gt; getAll(){
    List&lt;Customer&gt; customers = messageStorage.getAll();
    return customers;
}

@DeleteMapping(value=&quot;/mq/customers/clear&quot;)
public String clearCustomerStorage() {
    messageStorage.clear();
    return &quot;Clear All CustomerStorage!&quot;;
}
</code></pre><p>}</p>
<p><code>`</code><br>post시 큐에 적재,<br>get시 현재 큐에 들어가 있는 데이터 read<br>delete시 큐에 들어가있는 데이터 clear</p>
<p>메시지 큐를 사용하여 다양한 서비스에 이용할수 있다. 예를들어<br>데이터를 저장하고 다른 일을 하나의 request에서 다 처리하게 될경우 블록상태가 된다. 자원은 한정적인데 해당 자원을 효율적으로 쓰는 방법을 연구해야 한다.</p>
<p>큐를 사용하면 좋을 것 같은?</p>
<ol>
<li><p>로그를 저장할 경우<br>하나의 어플리케이션에서 로그찍을 데이터를 큐에 적재 -&gt; 다른 어플리케이션에서 큐를 listen하다 듣게 될경우 별도의 S3같은 서비스에 저장</p>
</li>
<li><p>푸쉬서비스<br>위의 로그와 동일하게 만들면 될것 같다.</p>
</li>
</ol>
<h2 id="AWS-with-큐"><a href="#AWS-with-큐" class="headerlink" title="AWS with 큐"></a>AWS with 큐</h2><p>aws에서 버튼 몇번만 누르면 생성되는 sqs 서비스가 있다. sqs와 Lamda서비스를 이용하게 될경우 재미난걸 만들어 낼수 있다. sqs를 검색하여 찾아보니 성능이 많이 뛰어나지 않음을 알수 있다. 람다를 쓰게 될경우 노드를 조금만 공부하여 쓰자! 다양한 언어들을 지원하나 자바를 쓸경우 느리다(통계가 그러하다). 파이썬 또는 노드를 선택하여 쓰자</p>

                    
                    <!-- Tags Bottom -->
                    
                        <div class="tags-container-bottom">
                            <i class="fa fa-tag pr3 text-main-color"></i><a class="fw3 ph1 dib" href="/tags/Spring/">#Spring</a> <a class="fw3 ph1 dib" href="/tags/JMS/">#JMS</a> <a class="fw3 ph1 dib" href="/tags/MQ/">#MQ</a>
                        </div>
                    

                    <!-- Comments -->
                    



                </div>
                <div class="fl w-100 w-30-l center fw3 lh-copy pl4-ns tl black-50">
                    
                    <hr class="dn-l mw4 black-50 mt5">
                    
                    <!-- Widget 1: About -->
                    <div class="mt5 mt0-l">
    <article class="dt db-l mw8 mw8-m mw5-ns center ml0-l bg-white mv3">
        <div class="dn dtc-m db-l v-mid tc pr4 pr0-l" style="min-width: 6rem;">
            <img src="http://tachyons.io/img/avatar_1.jpg" class="mb4-l br-100 h3 w3 h4-l w4-l dib" title="beanbroker">
        </div>
        <div class="dtc db-l v-mid lh-copy measure center f6 black-50 tj">
            Good to see you! have a fun
        </div>
    </article>
 <!-- vertical_google ads -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- vertical -->
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7332507555012085" data-ad-slot="7532778343" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- vertical_google ads -->

</div>


                    <hr class="dn-l mw4 black-50 mt5">
                    
                    <!-- Widget 2: Categories -->
                    
                        <div class="mt5 tc tl-l">
    <h3>Categories</h3>
    
        <p>
            <a href="/categories/Spring/">Spring</a>
        </p>
    
        <p>
            <a href="/categories/Spring/JMS/">JMS</a>
        </p>
    
        <p>
            <a href="/categories/Spring/JMS/MQ/">MQ</a>
        </p>
    
</div>


                        <hr class="dn-l mw4 black-50 mt5">
                    

                    <!-- Widget 3: Recent Posts -->
                    <div class="mt5 tc tl-l">
    <h3>Recent Posts</h3>
    
        <p>
            <a href="/2020/07/12/Spring/spring_mongodb_docker_replica/">Spring MongoDB Docker replica 설정</a>
        </p>
    
        <p>
            <a href="/2020/07/04/Spring/spring_es_search1/">Spring Elastic Search 연동(docker)</a>
        </p>
    
        <p>
            <a href="/2020/05/30/Spring/test_code4/">Spring Test Code 4</a>
        </p>
    
        <p>
            <a href="/2020/02/16/Spring/spring_security2/">Spring Security 2장 버젼 업그레이드</a>
        </p>
    
        <p>
            <a href="/2020/02/15/Spring/spring_security1/">Spring Security 1장 간단 구현</a>
        </p>
    
        <p>
            <a href="/2019/12/14/Kotlin/kotlin_webflux_sse/">SSE(Server-Sent Events) with Spring kotlin</a>
        </p>
    
        <p>
            <a href="/2019/12/01/etc/cors_curl/">CORS 체크 curl</a>
        </p>
    
        <p>
            <a href="/2019/11/09/Java/Java8_default_method/">Java8 default method</a>
        </p>
    

	<script src="https://ads-partners.coupang.com/g.js"></script>
<script>
	new PartnersCoupang.G({ id: AF0184271 });
</script>


</div>

                </div>
            </div>
        </div>
    </div>
</div>


<!-- Footer -->
<div class="bg-1 ph2 ph5-ns pv5">
        <div class="mv8">
            <div class="center tc">
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://www.facebook.com/" target="_blank" rel="external nofollow noopener noreferrer">
                            <i class="fa fa-facebook"></i>
                        </a>
                    </div>
                
                    <div class="dib mh3">
                        <a class="f3 f2-ns white dim" href="https://github.com/beanbroker" target="_blank" rel="external nofollow noopener noreferrer">
                            <i class="fa fa-github"></i>
                        </a>
                    </div>
                
            </div>
            <div class="f6 f5-ns center tc white pt5 fw3">
                @Beanbroker blog All right reserved | Design & Hexo <a class="link dim white" href="http://www.codeblocq.com/" rel="external nofollow noopener noreferrer" target="_blank">Jonathan Klughertz</a>
            </div>
        </div>
    </div>

 <!-- horizontal_google Top -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- horizontal -->
<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7332507555012085" data-ad-slot="3920642873" data-ad-format="auto" data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>

<!-- horizontal_google Top -->


<!-- After Footer -->
<!-- Disqus Comments -->



</body>

</html>
